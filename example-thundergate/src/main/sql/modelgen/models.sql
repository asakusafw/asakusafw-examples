DROP TABLE IF EXISTS STOCK;
CREATE TABLE STOCK (
    -- System columns for BulkLoader
    SID               BIGINT     PRIMARY KEY AUTO_INCREMENT,
    VERSION_NO BIGINT            NULL,
    RGST_DATETIME DATETIME           NULL,
    UPDT_DATETIME DATETIME           NULL,
    
    -- Application columns
    PURCHASED_DATE    DATETIME   NOT NULL,
    ITEM_CODE         BIGINT     NOT NULL,
    COST              INT        NOT NULL,
    QUANTITY          INT        NOT NULL
) ENGINE=InnoDB;

DROP TABLE IF EXISTS SHIPMENT;
CREATE TABLE SHIPMENT (
    -- System columns for BulkLoader
    SID               BIGINT     PRIMARY KEY AUTO_INCREMENT,
    VERSION_NO BIGINT            NULL,
    RGST_DATETIME DATETIME           NULL,
    UPDT_DATETIME DATETIME           NULL,
    
    -- Application columns
    SHIPPED_DATE      DATETIME   NULL,
    ITEM_CODE         BIGINT     NOT NULL,
    COST              INT        NULL
) ENGINE=InnoDB;


-- test data

-- STOCK(1): 3 -> 2
INSERT STOCK (PURCHASED_DATE, ITEM_CODE, QUANTITY, COST) VALUES ('2010-12-01 00:00:00', 1, 3, 100);
INSERT SHIPMENT (SHIPPED_DATE, ITEM_CODE) VALUES ('2010-12-01 12:00:00', 1);

-- STOCK(2): 2 -> 0 (-1)
INSERT STOCK (PURCHASED_DATE, ITEM_CODE, QUANTITY, COST) VALUES ('2010-12-01 00:00:00', 2, 2, 100);
INSERT SHIPMENT (SHIPPED_DATE, ITEM_CODE) VALUES ('2010-12-01 12:00:00', 2);
INSERT SHIPMENT (SHIPPED_DATE, ITEM_CODE) VALUES ('2010-12-01 12:02:00', 2);
INSERT SHIPMENT (SHIPPED_DATE, ITEM_CODE) VALUES ('2010-12-01 12:01:00', 2);

-- STOCK(3): (3, 2) -> (2, 0)
INSERT STOCK (PURCHASED_DATE, ITEM_CODE, QUANTITY, COST) VALUES ('2010-12-01 01:00:00', 3, 3, 100);
INSERT STOCK (PURCHASED_DATE, ITEM_CODE, QUANTITY, COST) VALUES ('2010-12-01 00:00:00', 3, 2, 100);
INSERT SHIPMENT (SHIPPED_DATE, ITEM_CODE) VALUES ('2010-12-01 12:00:00', 3);
INSERT SHIPMENT (SHIPPED_DATE, ITEM_CODE) VALUES ('2010-12-01 12:01:00', 3);
INSERT SHIPMENT (SHIPPED_DATE, ITEM_CODE) VALUES ('2010-12-01 12:02:00', 3);
INSERT SHIPMENT (SHIPPED_DATE, ITEM_CODE) VALUES ('2010-12-01 12:03:00', 3);

-- invalid shipment
INSERT SHIPMENT (SHIPPED_DATE, ITEM_CODE) VALUES ('2010-12-01 12:00:00', 999);

